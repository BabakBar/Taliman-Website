---
import { getLangFromUrl, useTranslations, getLocalizedPath } from '../lib/i18n';

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const currentPath = Astro.url.pathname;

const navItems = [
  { key: 'nav.home', href: '/' },
  { key: 'nav.about', href: '/#about' },
  { key: 'nav.processes', href: '/#processes' },
  { key: 'nav.equipment', href: '/#equipment' },
  { key: 'nav.quality', href: '/#quality' },
  { key: 'nav.contact', href: '/#contact' },
] as const;

const otherLang = lang === 'fa' ? 'en' : 'fa';
const otherLangPath = lang === 'fa' ? '/en' : '/';
---

<header class="glass sticky top-0 z-50 border-b border-fog/50">
  <nav class="container mx-auto px-4 sm:px-6 lg:px-8" aria-label="Main navigation">
    <div class="flex h-16 items-center justify-between md:h-20">
      <!-- Logo -->
      <a href={getLocalizedPath('/', lang)} class="flex items-center gap-3">
        <img src="/images/logo.png" alt="Taliman Logo" class="h-10 w-auto md:h-12" />
        <span class="hidden text-lg font-bold text-near-black lg:block">
          {lang === 'fa' ? 'تلیمان' : 'Taliman'}
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden items-center gap-8 md:flex">
        {
          navItems.map(({ key, href }) => (
            <a
              href={getLocalizedPath(href, lang)}
              class="group relative text-sm font-medium text-steel transition-colors hover:text-accent"
            >
              {t(key)}
              <span class="absolute -bottom-1 left-0 h-0.5 w-0 bg-gradient-metallic transition-all duration-300 group-hover:w-full"></span>
            </a>
          ))
        }
      </div>

      <!-- Language Switcher -->
      <a
        href={otherLangPath}
        class="rounded-lg border-2 border-accent px-4 py-2 text-sm font-medium text-accent transition-colors hover:bg-accent-subtle"
      >
        {otherLang === 'fa' ? 'فارسی' : 'English'}
      </a>
    </div>

    <!-- Mobile Navigation -->
    <div class="md:hidden">
      <details class="group">
        <summary
          class="flex cursor-pointer items-center justify-center gap-2 py-2 text-sm font-medium text-steel marker:content-none"
        >
          <span>{t('nav.home')}</span>
          <svg
            class="h-4 w-4 transition-transform group-open:rotate-180"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"
            ></path>
          </svg>
        </summary>
        <div class="border-t border-fog bg-cream py-4">
          {
            navItems.map(({ key, href }) => (
              <a
                href={getLocalizedPath(href, lang)}
                class="block px-4 py-3 text-sm font-medium text-steel transition-colors hover:bg-cloud hover:text-accent"
              >
                {t(key)}
              </a>
            ))
          }
        </div>
      </details>
    </div>
  </nav>
</header>
